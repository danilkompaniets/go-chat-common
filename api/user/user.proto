syntax = "proto3";

package user;

option go_package = "github.com/danilkompaniets/go-chat-common/gen/user";

import "common/common.proto";

import "google/protobuf/timestamp.proto";


service UserService {
  rpc CreateUser(CreateUserRequest) returns (CreateUserResponse);

  rpc GetUserByID(GetUserRequest) returns (GetUserResponse);

  rpc SearchUsers(SearchUsersRequest) returns (SearchUsersResponse);
  rpc GetUsersByIDs(BatchGetUsersRequest) returns (BatchGetUsersResponse);

  rpc UpdateName(UpdateNameRequest) returns (UpdateResponse);
  rpc UpdateBio(UpdateBioRequest) returns (UpdateResponse);
  rpc SendFriendRequest(SendFriendRequestRequest) returns (UpdateResponse);

  rpc AcceptFriendRequest(AcceptFriendRequestRequest) returns (UpdateResponse);
  rpc DeclineFriendRequest(DeclineFriendRequestRequest) returns (UpdateResponse);
  rpc RemoveFriend(RemoveFriendRequest) returns (UpdateResponse);
  rpc GetFriends(GetFriendsRequest) returns (GetFriendsResponse);
  rpc GetIncomingRequests(GetRequestsRequest) returns (GetRequestsResponse);
  rpc GetOutgoingRequests(GetRequestsRequest) returns (GetRequestsResponse);
}

message GetUserRequest {
  int64 user_id = 1;
}

message GetUserResponse {
  common.User user = 1;
}

message SearchUsersRequest {
  string query = 1;
}

message SearchUsersResponse {
  repeated common.User users = 1;
}

message BatchGetUsersRequest {
  repeated int64 ids = 1;
}

message BatchGetUsersResponse {
  repeated common.User users = 1;
}

message UpdateNameRequest {
  int64 user_id = 1;
  string name = 2;
}

message UpdateBioRequest {
  int64 user_id = 1;
  string bio = 2;
}

message UpdateResponse {
  bool success = 1;
}

message SendFriendRequestRequest {
  int64 from_user_id = 1;
  int64 to_user_id = 2;
}

message AcceptFriendRequestRequest {
  int64 user_id = 1;
  int64 request_id = 2;
}

message DeclineFriendRequestRequest {
  int64 user_id = 1;
  int64 request_id = 2;
}

message RemoveFriendRequest {
  int64 user_id = 1;
  int64 friend_id = 2;
}

message GetFriendsRequest {
  int64 user_id = 1;
}

message GetFriendsResponse {
  repeated common.User friends = 1;
}

message GetRequestsRequest {
  int64 user_id = 1;
}

message FriendRequestInfo {
  int64 request_id = 1;
  string request_status = 2;
  google.protobuf.Timestamp created_at = 3;
  int64 user_id = 4;
  string user_name = 5;
  string user_bio = 6;
}

message GetRequestsResponse {
  repeated FriendRequestInfo requests = 1;
}

message CreateUserRequest {
  string name = 2;
  string bio = 3;
}

message CreateUserResponse {
}